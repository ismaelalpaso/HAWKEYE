{"ast":null,"code":"// src/components/api/auth.js\nimport { apiBase, buildApiUrl } from \"./config\";\nexport async function login(username, password) {\n  const url = buildApiUrl(\"/api/auth/login/\");\n  const response = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) {\n    // Intenta leer detalle si el backend lo manda\n    let detail = \"Login failed\";\n    try {\n      const data = await response.json();\n      if (data && (data.detail || data.error)) {\n        detail = data.detail || data.error;\n      }\n    } catch {}\n    throw new Error(detail);\n  }\n  const data = await response.json();\n\n  // ✅ Guarda tokens JWT\n  localStorage.setItem(\"accessToken\", data.access);\n  localStorage.setItem(\"refreshToken\", data.refresh);\n  return data;\n}\nexport async function refreshToken() {\n  const refresh = localStorage.getItem(\"refreshToken\");\n  if (!refresh) return null;\n  const url = buildApiUrl(\"/api/auth/refresh/\");\n  const response = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      refresh\n    })\n  });\n  if (!response.ok) {\n    localStorage.removeItem(\"accessToken\");\n    localStorage.removeItem(\"refreshToken\");\n    return null;\n  }\n  const data = await response.json();\n  localStorage.setItem(\"accessToken\", data.access);\n  return data.access;\n}\nexport async function authFetch(url, options = {}) {\n  const fullUrl = buildApiUrl(url);\n  let token = localStorage.getItem(\"accessToken\");\n  let headers = {\n    \"Content-Type\": \"application/json\",\n    ...options.headers\n  };\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  let response = await fetch(fullUrl, {\n    ...options,\n    headers\n  });\n  if (response.status === 401) {\n    // Token expirado: intenta refresh\n    token = await refreshToken();\n    if (token) {\n      headers[\"Authorization\"] = `Bearer ${token}`;\n      response = await fetch(fullUrl, {\n        ...options,\n        headers\n      });\n      // ... dentro de authFetch, en el else de \"if (token) ...\" tras intentar refresh:\n    } else {\n      // Antes: window.location.href = '/login';\n      // Ahora: disparamos un evento global para mostrar el modal\n      localStorage.removeItem('accessToken');\n      localStorage.removeItem('refreshToken');\n      window.dispatchEvent(new Event('session-expired'));\n      return null;\n    }\n  }\n  return response;\n}","map":{"version":3,"names":["apiBase","buildApiUrl","login","username","password","url","response","fetch","method","headers","body","JSON","stringify","ok","detail","data","json","error","Error","localStorage","setItem","access","refresh","refreshToken","getItem","removeItem","authFetch","options","fullUrl","token","status","window","dispatchEvent","Event"],"sources":["C:/Users/ismaa/Desktop/HAWKEYE_SOFTWARE/hawkeye_backend/frontend/src/api/auth.js"],"sourcesContent":["// src/components/api/auth.js\r\nimport { apiBase, buildApiUrl } from \"./config\";\r\n\r\nexport async function login(username, password) {\r\n  const url = buildApiUrl(\"/api/auth/login/\");\r\n  const response = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    // Intenta leer detalle si el backend lo manda\r\n    let detail = \"Login failed\";\r\n    try {\r\n      const data = await response.json();\r\n      if (data && (data.detail || data.error)) {\r\n        detail = data.detail || data.error;\r\n      }\r\n    } catch {}\r\n    throw new Error(detail);\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  // ✅ Guarda tokens JWT\r\n  localStorage.setItem(\"accessToken\", data.access);\r\n  localStorage.setItem(\"refreshToken\", data.refresh);\r\n\r\n  return data;\r\n}\r\n\r\nexport async function refreshToken() {\r\n  const refresh = localStorage.getItem(\"refreshToken\");\r\n  if (!refresh) return null;\r\n\r\n  const url = buildApiUrl(\"/api/auth/refresh/\");\r\n  const response = await fetch(url, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ refresh }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    localStorage.removeItem(\"accessToken\");\r\n    localStorage.removeItem(\"refreshToken\");\r\n    return null;\r\n  }\r\n\r\n  const data = await response.json();\r\n  localStorage.setItem(\"accessToken\", data.access);\r\n  return data.access;\r\n}\r\n\r\nexport async function authFetch(url, options = {}) {\r\n  const fullUrl = buildApiUrl(url);\r\n  let token = localStorage.getItem(\"accessToken\");\r\n  let headers = { \"Content-Type\": \"application/json\", ...options.headers };\r\n\r\n  if (token) {\r\n    headers[\"Authorization\"] = `Bearer ${token}`;\r\n  }\r\n\r\n  let response = await fetch(fullUrl, { ...options, headers });\r\n\r\n  if (response.status === 401) {\r\n    // Token expirado: intenta refresh\r\n    token = await refreshToken();\r\n    if (token) {\r\n      headers[\"Authorization\"] = `Bearer ${token}`;\r\n      response = await fetch(fullUrl, { ...options, headers });\r\n    // ... dentro de authFetch, en el else de \"if (token) ...\" tras intentar refresh:\r\n    } else {\r\n      // Antes: window.location.href = '/login';\r\n      // Ahora: disparamos un evento global para mostrar el modal\r\n      localStorage.removeItem('accessToken');\r\n      localStorage.removeItem('refreshToken');\r\n      window.dispatchEvent(new Event('session-expired'));\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return response;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}