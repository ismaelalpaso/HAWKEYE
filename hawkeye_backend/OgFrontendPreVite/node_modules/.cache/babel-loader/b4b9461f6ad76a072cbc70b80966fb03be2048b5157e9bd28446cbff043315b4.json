{"ast":null,"code":"// src/api/auth.js\n\nexport async function login(username, password) {\n  //const response = await fetch('http://localhost:8000/api/auth/login/', { solo localhost\n  const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/login/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) {\n    throw new Error('Login failed');\n  }\n  const data = await response.json();\n\n  // ✅ Guarda los tokens con claves estándar\n  localStorage.setItem('accessToken', data.access);\n  localStorage.setItem('refreshToken', data.refresh);\n  return data;\n}\nexport async function refreshToken() {\n  const refresh = localStorage.getItem('refreshToken');\n  if (!refresh) return null;\n  const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/refresh/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      refresh\n    })\n  });\n  if (!response.ok) {\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    return null;\n  }\n  const data = await response.json();\n  localStorage.setItem('accessToken', data.access);\n  return data.access;\n}\nexport async function authFetch(url, options = {}) {\n  const baseUrl = process.env.REACT_APP_API_URL;\n  const fullUrl = url.startsWith('http') ? url : `${baseUrl}${url}`;\n  let token = localStorage.getItem('accessToken');\n  let headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n  let response = await fetch(fullUrl, {\n    ...options,\n    headers\n  });\n  if (response.status === 401) {\n    // Token posiblemente expirado, intentar refresh\n    token = await refreshToken();\n    if (token) {\n      headers['Authorization'] = `Bearer ${token}`;\n      response = await fetch(fullUrl, {\n        ...options,\n        headers\n      });\n    } else {\n      // No se pudo refrescar token, forzar logout\n      localStorage.removeItem('accessToken');\n      localStorage.removeItem('refreshToken');\n      window.location.href = '/login';\n      return null;\n    }\n  }\n  return response;\n}","map":{"version":3,"names":["login","username","password","response","fetch","process","env","REACT_APP_API_URL","method","headers","body","JSON","stringify","ok","Error","data","json","localStorage","setItem","access","refresh","refreshToken","getItem","removeItem","authFetch","url","options","baseUrl","fullUrl","startsWith","token","status","window","location","href"],"sources":["C:/Users/ismaa/Desktop/HAWKEYE_SOFTWARE/hawkeye_backend/frontend/src/components/api/auth.js"],"sourcesContent":["// src/api/auth.js\r\n\r\nexport async function login(username, password) {\r\n  //const response = await fetch('http://localhost:8000/api/auth/login/', { solo localhost\r\n  const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/login/`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({ username, password })\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Login failed');\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  // ✅ Guarda los tokens con claves estándar\r\n  localStorage.setItem('accessToken', data.access);\r\n  localStorage.setItem('refreshToken', data.refresh);\r\n\r\n  return data;\r\n}\r\n\r\nexport async function refreshToken() {\r\n  const refresh = localStorage.getItem('refreshToken');\r\n  if (!refresh) return null;\r\n\r\n  const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/refresh/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ refresh }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    localStorage.removeItem('accessToken');\r\n    localStorage.removeItem('refreshToken');\r\n    return null;\r\n  }\r\n\r\n  const data = await response.json();\r\n  localStorage.setItem('accessToken', data.access);\r\n  return data.access;\r\n}\r\n\r\nexport async function authFetch(url, options = {}) {\r\n  const baseUrl = process.env.REACT_APP_API_URL;\r\n  const fullUrl = url.startsWith('http')\r\n    ? url\r\n    : `${baseUrl}${url}`;\r\n\r\n  let token = localStorage.getItem('accessToken');\r\n  let headers = { 'Content-Type': 'application/json', ...options.headers };\r\n\r\n  if (token) {\r\n    headers['Authorization'] = `Bearer ${token}`;\r\n  }\r\n\r\n  let response = await fetch(fullUrl, { ...options, headers });\r\n\r\n  if (response.status === 401) {\r\n    // Token posiblemente expirado, intentar refresh\r\n    token = await refreshToken();\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`;\r\n      response = await fetch(fullUrl, { ...options, headers });\r\n    } else {\r\n      // No se pudo refrescar token, forzar logout\r\n      localStorage.removeItem('accessToken');\r\n      localStorage.removeItem('refreshToken');\r\n      window.location.href = '/login';\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return response;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}